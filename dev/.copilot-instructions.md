# GitHub Copilot Instructions for uDESK v1.0.7
# Universal Development Environment & System Kit

## Project Context
- **Project**: uDESK v1.0.7.2 - Universal Desktop OS
- *# uDESK v1.0.7.2 Copilot Instructions
# Universal Desktop OSBase**: TinyCore Linux integration with modern Tauri application
- **Language**: uCODE dual-context command syntax (CLI: `HELP` | Documentation: `[HELP]`)
- **Architecture**: Clean build system with mode separation (User/Wizard+/Developer)
- **Deployment**: Cross-platform (macOS/Ubuntu/Windows) with zero dependencies
- **Commands**: UPPERCASE display format with case-insensitive input processing

## Version Guidelines
- Always use version **1.0.7** in code, documentation, and references
- Based on unified build system with mode separation
- TinyCore Linux integration with native commands
- Clean structure: no VM dependencies, Tauri app is optional modern interface
- Cross-platform support via GCC-only builds

## Code Standards

### uCODE Dual-Context Syntax (v1.0.7)
```rust
// CLI Context: Direct commands (case-insensitive input, UPPERCASE output)
match toupper(command).as_str() {
    "HELP" => show_help(),
    "BACKUP" => handle_backup(),
    "RESTORE" => handle_restore(),
    "CONFIG" => show_config(),
    "EXIT" | "QUIT" => exit_session(),
    // ... role validation required
}

// Documentation Context: Shortcodes with brackets
match command.as_str() {
    "[HELP]" => show_help(),
    "[BACKUP|FULL]" => handle_full_backup(),
    "[CONFIG|SET*KEY*VALUE]" => set_config_value(key, value),
    "[MEMORY|SEARCH*TERM]" => search_memory(term),
    // ... bracket format with pipe and asterisk separators
}
```

### TinyCore Integration
```rust
// Always use TinyCore native commands
Command::new("filetool.sh").args(["-b"])  // Backup
Command::new("tce-load").args(["-i"])     // Extensions  
Command::new("sudo").args(["reboot"])     // System control
```

### Role-Based Access Control (Corrected Hierarchy)
```rust
// Implement 8-tier hierarchy (corrected order)
const ROLES: &[(u8, &str, &str)] = &[
    (10, "GHOST", "👻"),      // Basic system monitoring
    (20, "TOMB", "⚰️"),       // Archive management
    (30, "DRONE", "🤖"),      // Standard operations
    (40, "CRYPT", "🔐"),      // Security operations
    (50, "IMP", "😈"),        // System manipulation
    (60, "KNIGHT", "⚔️"),     // Network operations
    (70, "SORCERER", "🔮"),   // Advanced scripting
    (100, "WIZARD", "🧙‍♂️"),   // Complete system access
];
```
];
```

## File Structure Rules

### Build System Architecture
```
# Current clean structure
uDESK/
├── README.md                    # Main documentation
├── build.sh                    # Unified build system
├── install.sh                  # System installer
├── uDESK-{platform}.sh         # Platform launchers
├── app/udesk-app/              # Modern Tauri application
│   ├── src/                    # React frontend
│   └── tauri/                  # Rust backend (renamed from src-tauri)
├── core/                       # uDESK core system  
│   ├── docs/                   # Documentation
│   └── tc/                     # TinyCore packages
└── build/                      # Build artifacts
    ├── user/                   # User mode binaries
    ├── wizard-plus/            # Wizard+ mode binaries
    └── clean-udos/             # Clean uDOS system
```

### Mode Separation
```bash
# Three distinct build modes
./build.sh user        # Standard users (all roles)
./build.sh wizard-plus # WIZARD role with Plus Mode capabilities
./build.sh developer   # Core system developers
./build.sh iso         # TinyCore ISO generation (optional)
```

## Command Implementation

### Command Format Standards (v1.0.7)
```rust
// UPPERCASE display format with case-insensitive input
fn format_command_output(cmd: &str) -> String {
    format!("  {}     - {}", cmd.to_uppercase(), get_description(cmd))
}

// Case-insensitive command processing
fn process_command(input: &str) -> String {
    let upper_cmd = input.to_uppercase();
    match upper_cmd.as_str() {
        "HELP" => show_help(),
        "BACKUP" => create_backup(),
        "EXIT" | "QUIT" => exit_program(),
        _ => format!("❌ Unknown command: {}\n   Use HELP for available commands", input)
    }
}
```

### Core uCODE Commands (7 implemented)
```rust
// TinyCore native system commands - UPPERCASE display format
udos_backup()    -> filetool.sh -b        // BACKUP - Create system backups
udos_restore()   -> filetool.sh -r        // RESTORE - Restore from backup archives
udos_destroy()   -> rm user data + clean  // DESTROY - Secure system cleanup
udos_reboot()    -> sudo reboot           // RESTART - Safe system restart
udos_repair()    -> fsck + validation     // REPAIR - File system repair
udos_undo()      -> restore last state    // UNDO - Reverse last operation
udos_redo()      -> replay operation      // REDO - Replay last successful operation
```

### Build System Commands
```bash
# Platform launchers (auto-install dependencies)
./uDESK-macOS.sh         # macOS with Xcode tools
./uDESK-Ubuntu.sh        # Ubuntu/Debian with build-essential
./uDESK-Windows.bat      # Windows with MinGW guidance

# Mode-specific builds
./build.sh user          # Fast GCC-only build
./build.sh wizard-plus   # Enhanced capabilities
./build.sh developer     # Full development features
```

### Error Handling
```rust
// Always provide meaningful error messages
.map_err(|e| format!("TinyCore operation failed: {}", e))?;

// Include context in error messages
Err(format!("Backup failed at step '{}': {}", cmd, error))
```

## Testing Guidelines

### Build Testing
```bash
# Test all three modes with UPPERCASE commands
echo "HELP" | ./build/user/udos
echo "[HELP]" | ./build/wizard-plus/udos-wizard-plus  
echo "[HELP]" | ./build/developer/udos-developer

# Test case-insensitive input
echo -e "help\nHELP\nHelp\nEXIT" | ./build/user/udos

# Validate installation
sudo ./installers/install.sh --test

# Platform testing
./uDESK-macOS.sh     # Test macOS launcher
./uDESK-Ubuntu.sh    # Test Ubuntu launcher
```

### Tauri App Testing
```bash
# Development testing
cd app/udesk-app
npm install
npm run tauri dev

# Production build testing
npm run tauri build
```

## Documentation Standards

### Always Include
- Version number (1.0.7)
- Mode information (User/Wizard+/Developer)
- uCODE command examples
- Role-based access requirements
- Cross-platform compatibility notes

### Code Comments
```rust
// ========================================
// uDESK v1.0.7.2 - Universal Desktop OS
// Clean architecture with mode separation
// ========================================
```

## Testing Guidelines

### Local Environment Testing
- Test all build modes (user/wizard-plus/developer)
- Verify cross-platform launcher functionality
- Validate TinyCore integration functions
- Ensure clean build artifacts generation

### Tauri App Testing
```rust
// Test modern interface functionality
let app = tauri::Builder::default()
    .invoke_handler(tauri::generate_handler![greet])
    .run(tauri::generate_context!())
    .expect("error while running tauri application");
```

## Common Patterns

### Version References
```rust
// Always use 1.0.7
const VERSION: &str = "1.0.7";
const APP_NAME: &str = "uDESK v1.0.7";
```

### Command Processing (v1.0.7)
```rust
// Standard dual-context uCODE parsing
fn parse_ucode(input: &str) -> Result<UCodeCommand, ParseError> {
    let trimmed = input.trim();
    
    // CLI Context: Direct commands (case-insensitive)
    if !trimmed.starts_with('[') {
        return Ok(UCodeCommand::Direct(trimmed.to_uppercase()));
    }
    
    // Documentation Context: Shortcodes with brackets
    let re = Regex::new(r"^\[([A-Z]+)(?:\|([A-Z]+)(?:\*(.+))?)?\]$")?;
    if let Some(caps) = re.captures(trimmed) {
        return Ok(UCodeCommand::Shortcode {
            command: caps.get(1).unwrap().as_str().to_string(),
            option: caps.get(2).map(|m| m.as_str().to_string()),
            parameter: caps.get(3).map(|m| m.as_str().to_string()),
        });
    }
    
    Err(ParseError::InvalidFormat)
}
```

### TinyCore Operations
```rust
// Always check for TinyCore environment
fn is_tinycore() -> bool {
    std::path::Path::new("/opt/tinycore").exists()
}
```

## Security Considerations

### Role Validation
```rust
// Always validate user role before operations
fn validate_role(user_level: u8, required_level: u8) -> Result<(), String> {
    if user_level < required_level {
        return Err("Insufficient permissions".to_string());
    }
    Ok(())
}
```

### Safe File Operations
```rust
// Use safe paths, prevent directory traversal
fn sanitize_path(input: &str) -> Result<PathBuf, String> {
    let path = PathBuf::from(input);
    if path.components().any(|c| c == Component::ParentDir) {
        return Err("Invalid path".to_string());
    }
    Ok(path)
}
```

---

*These instructions ensure consistent development practices for uDESK v1.0.7 with clean architecture, mode separation, and cross-platform support.*
