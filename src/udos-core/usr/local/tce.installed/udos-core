#!/bin/bash\n# TinyCore post-install hook for udos-core.tcz\n# This script runs automatically when udos-core.tcz is loaded\n\necho \"Installing uDESK Core v1.0.6...\"\n\n# Create uDESK directories\nmkdir -p /etc/udos\nmkdir -p /opt/udos/{bin,lib,templates,logs}\nmkdir -p /home/tc/.udos/{vars,data,templates,logs}\n\n# Set up persistence for uDESK files\nFILETOOL_LST=\"/opt/.filetool.lst\"\n\n# Add uDESK paths to persistence (avoid duplicates)\nfor path in \"/etc/udos\" \"/home/tc/.udos\" \"/opt/udos\"; do\n    if ! grep -q \"^$path\" \"$FILETOOL_LST\" 2>/dev/null; then\n        echo \"$path\" >> \"$FILETOOL_LST\"\n        echo \"Added $path to persistence\"\n    fi\ndone\n\n# Create default role if none exists\nif [ ! -f /etc/udos/role ]; then\n    echo \"basic\" > /etc/udos/role\n    echo \"Set default role: basic\"\nfi\n\n# Create system info markdown\ncat > /etc/udos/system.md << 'EOF'\n# uDESK System Configuration\n\n**Version**: 1.0.6  \n**Base**: TinyCore Linux  \n**Install Date**: AUTO_REPLACE_DATE  \n**Default Role**: basic\n\n## Core Philosophy\n\nEverything in uDESK is markdown:\n- Configuration files\n- System documentation  \n- User templates\n- Service definitions\n- Log formats\n\n## Directory Structure\n\n- `/etc/udos/` - System configuration (markdown)\n- `/opt/udos/` - uDESK applications and data\n- `~/.udos/` - Per-user data and settings\n\n## Markdown Tools\n\n- **Editor**: micro (syntax highlighting, mouse support)\n- **Viewer**: glow (beautiful terminal rendering)\n- **Processor**: Custom uDESK markdown pipeline\n\n*This file was generated automatically during uDESK installation.*\nEOF\n\n# Replace date placeholder\nsed -i \"s/AUTO_REPLACE_DATE/$(date)/g\" /etc/udos/system.md\n\n# Set ownership\nchown -R tc:staff /home/tc/.udos 2>/dev/null || true\nchown -R root:root /etc/udos /opt/udos\n\n# Add uDESK to system PATH\nif ! grep -q \"/opt/udos/bin\" /etc/profile 2>/dev/null; then\n    echo 'export PATH=\"/opt/udos/bin:$PATH\"' >> /etc/profile\nfi\n\n# Create welcome message for first boot\ncat > /home/tc/udesk-welcome.md << 'EOF'\n# Welcome to uDESK!\n\nðŸŽ‰ **Your markdown-focused operating system is ready!**\n\n## Quick Start\n\n### View this message beautifully:\n```bash\nglow udesk-welcome.md\n```\n\n### Edit markdown files:\n```bash\nmicro my-document.md\n```\n\n### Check system status:\n```bash\nudos-info\n```\n\n### Change your role:\n```bash\necho \"standard\" > /etc/udos/role\nexec bash  # Reload environment\n```\n\n## Your Current Role\n\n**Role**: $(cat /etc/udos/role)  \n**Capabilities**: Run `udos-info` to see what you can do\n\n## Everything is Markdown\n\nIn uDESK, every configuration file, every document, every template is written in markdown. This makes the entire system:\n\n- **Human readable** - No cryptic config formats\n- **Easily editable** - Use any text editor  \n- **Self-documenting** - Configs explain themselves\n- **Version controllable** - Track changes with git\n\n## Next Steps\n\n1. **Explore**: `ls /etc/udos/*.md`\n2. **Configure**: Edit markdown config files\n3. **Create**: Start your first markdown project\n4. **Enjoy**: The simplicity and power of markdown everywhere!\n\n*Welcome to the future of human-readable computing!*\nEOF\n\nchown tc:staff /home/tc/udesk-welcome.md 2>/dev/null || true\n\necho \"âœ“ uDESK Core installation complete\"\necho \"Welcome file created: /home/tc/udesk-welcome.md\"\necho \"View with: glow /home/tc/udesk-welcome.md\"\n