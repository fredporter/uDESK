# GitHub Copilot Instructions for uDESK v1.0.7
# Universal Development Environment & System Kit

## Project Context
- **Project**: uDESK v1.0.7 - Universal Development Environment & System Kit
- **Base**: TinyCore Linux integration with modern Tauri application
- **Language**: uCODE command syntax `[COMMAND|OPTION*PARAMETER]`
- **Architecture**: Clean build system with mode separation (User/Wizard+/Developer)
- **Deployment**: Cross-platform (macOS/Ubuntu/Windows) with zero dependencies

## Version Guidelines
- Always use version **1.0.7** in code, documentation, and references
- Based on unified build system with mode separation
- TinyCore Linux integration with native commands
- Clean structure: no VM dependencies, Tauri app is optional modern interface
- Cross-platform support via GCC-only builds

## Code Standards

### uCODE Syntax
```rust
// Correct uCODE parsing pattern
match command.as_str() {
    "BACKUP" => handle_backup(),
    "RESTORE" => handle_restore(),
    "REPAIR" => handle_repair(),
    // ... 8-tier role validation required
}
```

### TinyCore Integration
```rust
// Always use TinyCore native commands
Command::new("filetool.sh").args(["-b"])  // Backup
Command::new("tce-load").args(["-i"])     // Extensions  
Command::new("sudo").args(["reboot"])     // System control
```

### Role-Based Access Control
```rust
// Implement 8-tier hierarchy (uDOS integration)
const ROLES: &[(u8, &str, &str)] = &[
    (10, "GHOST", "👻"),     // Minimal observer access
    (20, "TOMB", "⚰️"),      // Read-only system access
    (30, "CRYPT", "�"),     // Basic encrypted operations
    (40, "DRONE", "🤖"),     // Automated task execution
    (50, "KNIGHT", "⚔️"),    // Standard user privileges
    (60, "IMP", "😈"),       // Enhanced user operations
    (80, "SORCERER", "🧙‍♂️"), // Advanced system control
    (100, "WIZARD", "🧙‍♀️"),  // Full administrative access
];
```

## File Structure Rules

### Build System Architecture
```
# Current clean structure
uDESK/
├── README.md                    # Main documentation
├── build.sh                    # Unified build system
├── install.sh                  # System installer
├── uDESK-{platform}.sh         # Platform launchers
├── app/udesk-app/              # Modern Tauri application
│   ├── src/                    # React frontend
│   └── tauri/                  # Rust backend (renamed from src-tauri)
├── core/                       # uDESK core system  
│   ├── docs/                   # Documentation
│   └── tc/                     # TinyCore packages
└── build/                      # Build artifacts
    ├── user/                   # User mode binaries
    ├── wizard-plus/            # Wizard+ mode binaries
    └── clean-udos/             # Clean uDOS system
```

### Mode Separation
```bash
# Three distinct build modes
./build.sh user        # Standard users (all roles)
./build.sh wizard-plus # WIZARD role with Plus Mode capabilities
./build.sh developer   # Core system developers
./build.sh iso         # TinyCore ISO generation (optional)
```

## Command Implementation

### Core uCODE Commands (7 implemented)
```rust
// TinyCore native system commands
udos_backup()    -> filetool.sh -b        // Create system backups
udos_restore()   -> filetool.sh -r        // Restore from backup archives
udos_destroy()   -> rm user data + clean  // Secure system cleanup
udos_reboot()    -> sudo reboot           // Safe system restart
udos_repair()    -> fsck + validation     // File system repair
udos_undo()      -> restore last state    // Reverse last operation
udos_redo()      -> replay operation      // Replay last successful operation
```

### Build System Commands
```bash
# Platform launchers (auto-install dependencies)
./uDESK-macOS.sh         # macOS with Xcode tools
./uDESK-Ubuntu.sh        # Ubuntu/Debian with build-essential
./uDESK-Windows.bat      # Windows with MinGW guidance

# Mode-specific builds
./build.sh user          # Fast GCC-only build
./build.sh wizard-plus   # Enhanced capabilities
./build.sh developer     # Full development features
```

### Error Handling
```rust
// Always provide meaningful error messages
.map_err(|e| format!("TinyCore operation failed: {}", e))?;

// Include context in error messages
Err(format!("Backup failed at step '{}': {}", cmd, error))
```

## Testing Guidelines

### Build Testing
```bash
# Test all three modes
echo "[INFO]" | ./build/user/udos
echo "[INFO]" | ./build/wizard-plus/udos  
echo "[INFO]" | ./build/developer/udos

# Validate installation
sudo ./install.sh --test

# Platform testing
./uDESK-macOS.sh     # Test macOS launcher
./uDESK-Ubuntu.sh    # Test Ubuntu launcher
```

### Tauri App Testing
```bash
# Development testing
cd app/udesk-app
npm install
npm run tauri dev

# Production build testing
npm run tauri build
```

## Documentation Standards

### Always Include
- Version number (1.0.7)
- Mode information (User/Wizard+/Developer)
- uCODE command examples
- Role-based access requirements
- Cross-platform compatibility notes

### Code Comments
```rust
// ========================================
// uDESK v1.0.7 - Universal Development Environment & System Kit
// Clean architecture with mode separation
// ========================================
```

## Testing Guidelines

### Local Environment Testing
- Test all build modes (user/wizard-plus/developer)
- Verify cross-platform launcher functionality
- Validate TinyCore integration functions
- Ensure clean build artifacts generation

### Tauri App Testing
```rust
// Test modern interface functionality
let app = tauri::Builder::default()
    .invoke_handler(tauri::generate_handler![greet])
    .run(tauri::generate_context!())
    .expect("error while running tauri application");
```

## Common Patterns

### Version References
```rust
// Always use 1.0.7
const VERSION: &str = "1.0.7";
const APP_NAME: &str = "uDESK v1.0.7";
```

### Command Processing
```rust
// Standard uCODE parsing
fn parse_ucode(input: &str) -> Result<UCodeCommand, ParseError> {
    let re = Regex::new(r"^\[([A-Z]+)(?:\|([A-Z]+)(?:\*(.+))?)?\]$")?;
    // Implementation...
}
```

### TinyCore Operations
```rust
// Always check for TinyCore environment
fn is_tinycore() -> bool {
    std::path::Path::new("/opt/tinycore").exists()
}
```

## Security Considerations

### Role Validation
```rust
// Always validate user role before operations
fn validate_role(user_level: u8, required_level: u8) -> Result<(), String> {
    if user_level < required_level {
        return Err("Insufficient permissions".to_string());
    }
    Ok(())
}
```

### Safe File Operations
```rust
// Use safe paths, prevent directory traversal
fn sanitize_path(input: &str) -> Result<PathBuf, String> {
    let path = PathBuf::from(input);
    if path.components().any(|c| c == Component::ParentDir) {
        return Err("Invalid path".to_string());
    }
    Ok(path)
}
```

---

*These instructions ensure consistent development practices for uDESK v1.0.7 with clean architecture, mode separation, and cross-platform support.*
